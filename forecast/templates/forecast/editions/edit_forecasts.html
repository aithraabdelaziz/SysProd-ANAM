{% extends "base.html" %}

{% load static wagtailcore_tags wagtailuserbar %}
{% load custom_tags %}
{% block content %}

<div class="container py-5">
  <h2 class="mb-4 text-center">Modifier les prévisions</h2>

  <div class="mb-4">
    <p><strong>Groupe de localités :</strong> {{ localite.name }}</p>
    <p><strong>Zone :</strong> {{ zone.name }}</p>
    <p><strong>Date :</strong> {{ date_aff }}   -   <strong>Echéance :</strong> {{ echeance }}</p>
  </div>

  <form method="post" class="bg-light p-4 rounded shadow-sm">
    {% csrf_token %}
    
    <div class="accordion" id="forecastAccordion">
      {% for forecast in forecasts %}
      <div class="accordion-item">
        <h2 class="accordion-header" id="heading{{ forecast.parametre.id }}">
          <button class="accordion-button {% if not forecast.prevision or forecast.prevision == 'None' %}border border-danger bg-danger-subtle{% else %}border border-success bg-success-subtle{% endif %}" type="button" data-bs-toggle="collapse" data-bs-target="#collapse{{ forecast.parametre.id }}" aria-expanded="true" aria-controls="collapse{{ forecast.parametre.id }}">
            <strong>{{ forecast.parametre.name }}</strong>
          </button>
        </h2>
        <div id="collapse{{ forecast.parametre.id }}" class="accordion-collapse collapse" aria-labelledby="heading{{ forecast.parametre.id }}" data-bs-parent="#forecastAccordion">
          <div class="accordion-body">
            {% if forecast.parametre.shortName == 'symbol_code' %}
                {{ weather_select|safe }}
            {% else %}
              <textarea name="value_{{ forecast.parametre.id }}" class="rich-text-editor form-control">{{ forecast.prevision |replace_none:""}}</textarea>
            {% endif %}
          </div>
        </div>
      </div>
      {% endfor %}
    </div>

    <input type="hidden" name="localite" value="{{localite.id}}">
    <input type="hidden" name="zone" value="{{zone.id}}">
    <input type="hidden" name="date" value="{{date}}">
    <input type="hidden" name="echeance" value="{{echeance}}">

    <div class="text-center mt-4">
      <button type="submit" class="btn btn-primary">Enregistrer</button>
    </div>
  </form>
</div>

<script src="{% static 'js/tinymce/tinymce.min.js' %}"></script>
<script>
  tinymce.init({
    selector: 'textarea.rich-text-editor',
    plugins: 'lists link image',
    toolbar: 'bold italic | bullist numlist | link',
    menubar: true,
    statusbar: false,
    height: 300,
    skin: 'oxide',
    content_css: 'default',
  });
</script>

{% endblock %}
